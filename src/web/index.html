<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BYOD Synthetic Data Generator</title>
    <!-- Favicon with fallback support -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/static/img/favicon.svg">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/data-editor.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-brand">🧬 BYOD Synthetic Data Generator</h1>
            <div class="nav-links">
                <a href="/" class="active">Home</a>
                <a href="/about">About</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <header>
            <h1>🔐 BYOD Synthetic Data Generator</h1>
            <p class="tagline">Generate privacy-safe synthetic data that preserves statistical properties</p>
        </header>

        <main>
            <!-- Dual Upload Section -->
            <section class="dual-upload-section">
                <div class="upload-grid">
                    <!-- Data File Upload -->
                    <div class="upload-box">
                        <h3>📊 Upload Data File</h3>
                        <div class="upload-area" id="uploadArea" tabindex="0">
                            <svg class="upload-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            <p>Drop your data file here</p>
                            <p class="file-types">CSV, JSON, Excel, Parquet, TSV</p>
                            <input type="file" id="fileInput" accept=".csv,.json,.xlsx,.xls,.parquet,.tsv,.txt" hidden>
                        </div>
                        <div id="fileInfo" class="file-info" style="display: none;">
                            <strong>Loaded:</strong> <span id="fileName"></span>
                            <div id="fileStats"></div>
                        </div>
                    </div>

                    <!-- OR Divider -->
                    <div class="or-divider">
                        <span>AND / OR</span>
                    </div>

                    <!-- Dictionary Upload -->
                    <div class="upload-box">
                        <h3>📖 Upload Data Dictionary</h3>
                        <div class="upload-area" id="dictionaryUploadArea" tabindex="0">
                            <svg class="upload-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            <p>Drop dictionary file here</p>
                            <p class="file-types">JSON, YAML, CSV, Excel, PDF</p>
                            <input type="file" id="dictionaryFileInput" accept=".json,.yaml,.yml,.csv,.xls,.xlsx,.pdf,.txt" hidden>
                        </div>
                        <div id="dictionaryInfo" class="file-info" style="display: none;">
                            <strong>Loaded:</strong> <span id="dictionaryFileName"></span>
                            <div id="dictionaryStats"></div>
                        </div>
                    </div>
                </div>

                <!-- Quick Start Options -->
                <div class="quick-start">
                    <button id="generateFromDataBtn" class="btn btn-primary" style="display: none;">🚀 Generate from Data</button>
                    <button id="generateFromDictBtn" class="btn btn-primary" style="display: none;">🚀 Generate from Dictionary</button>
                    <button id="generateFromBothBtn" class="btn btn-primary" style="display: none;">🚀 Generate with Both</button>
                </div>
            </section>

            <!-- Demo Mode - Compact Single Row -->
            <section class="demo-section-compact">
                <h3>Try Demo Datasets:</h3>
                <div class="demo-buttons-row">
                    <button class="demo-btn-compact" data-demo="sales" title="Sales Data">💰 Sales</button>
                    <button class="demo-btn-compact" data-demo="customer" title="Customer Data">👥 Customer</button>
                    <button class="demo-btn-compact" data-demo="medical" title="Medical Records">🏥 Medical</button>
                    <button class="demo-btn-compact" data-demo="financial" title="Financial Transactions">💳 Financial</button>
                </div>
            </section>

            <!-- Data Editor Section -->
            <section class="data-editor-section" id="dataEditorSection" style="display: none;">
                <div class="editor-header">
                    <h2>📝 Data Preview & Editor</h2>
                    <div class="editor-controls">
                        <button id="addRowBtn" class="btn btn-small">➕ Add Row</button>
                        <button id="addColBtn" class="btn btn-small">➕ Add Column</button>
                        <button id="deleteRowBtn" class="btn btn-small btn-danger">🗑️ Delete Row</button>
                        <button id="deleteColBtn" class="btn btn-small btn-danger">🗑️ Delete Column</button>
                        <button id="randomizeBtn" class="btn btn-small btn-warning">🎲 Randomize Values</button>
                        <button id="resetDataBtn" class="btn btn-small btn-secondary">↺ Reset</button>
                    </div>
                </div>
                
                <div class="data-stats" id="dataStats">
                    <span>Rows: <strong id="rowCount">0</strong></span>
                    <span>Columns: <strong id="colCount">0</strong></span>
                    <span>Cells: <strong id="cellCount">0</strong></span>
                </div>

                <div class="table-container" id="tableContainer">
                    <table id="dataTable" class="data-table">
                        <thead id="tableHead"></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>

                <div class="editor-actions">
                    <button id="saveChangesBtn" class="btn btn-primary">💾 Save Changes</button>
                    <button id="discardChangesBtn" class="btn btn-secondary">❌ Discard Changes</button>
                </div>
            </section>

            <!-- Dictionary Details (Hidden by default, shown when dictionary loaded) -->
            <section class="dictionary-details" id="dictionaryDetails" style="display: none;">
                <h3>📖 Dictionary Constraints Applied</h3>
                <div id="dictionaryColumns"></div>
                <button id="clearDictionaryBtn" class="btn btn-small btn-secondary">❌ Clear Dictionary</button>
            </section>

            <!-- Configuration Section -->
            <section class="config-section" id="configSection" style="display: none;">
                <h2>Generation Settings</h2>
                
                <div class="form-group">
                    <label for="numRows">Number of Rows to Generate:</label>
                    <input type="number" id="numRows" min="1" max="1000000" placeholder="Leave empty to match original">
                </div>

                <div class="form-group">
                    <label for="matchThreshold">
                        Match Strictness: <span id="thresholdValue">80%</span>
                    </label>
                    <input type="range" id="matchThreshold" min="0" max="100" value="80">
                    <div class="threshold-labels">
                        <span>Loose Match</span>
                        <span>Exact Match</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="outputFormat">Output Format:</label>
                    <select id="outputFormat">
                        <option value="csv">CSV</option>
                        <option value="json">JSON</option>
                        <option value="excel">Excel</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="useCache" checked>
                        Use cached generation (faster)
                    </label>
                </div>

                <div class="button-group">
                    <button id="extractMetadataBtn" class="btn btn-secondary">
                        📊 Extract Metadata Only
                    </button>
                    <button id="generateBtn" class="btn btn-primary">
                        🚀 Generate Synthetic Data
                    </button>
                    <div class="file-count-selector">
                        <label for="fileCount">Files:</label>
                        <select id="fileCount">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- Preview Section -->
            <section class="preview-section" id="previewSection" style="display: none;">
                <h2>📊 Generated Data Preview</h2>
                <p id="previewInfo" class="preview-info"></p>

                <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                    <table id="previewTable" class="data-table">
                        <thead id="previewHead"></thead>
                        <tbody id="previewBody"></tbody>
                    </table>
                </div>

                <div class="button-group" style="margin-top: 20px;">
                    <button id="downloadFileBtn" class="btn btn-primary">📥 Download File</button>
                    <button id="downloadZipBtn" class="btn btn-primary" style="display: none;">📦 Download ZIP</button>
                    <button id="regenerateBtn" class="btn btn-secondary">🔄 Regenerate</button>
                    <button id="newFileBtn" class="btn btn-secondary">📂 New File</button>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section" id="resultsSection" style="display: none;">
                <h2>Results</h2>
                <div id="resultsContent"></div>
                <div class="button-group">
                    <button id="downloadBtn" class="btn btn-primary" style="display: none;">
                        ⬇️ Download Synthetic Data
                    </button>
                    <button id="viewSyntheticBtn" class="btn btn-secondary" style="display: none;">
                        👁️ View Synthetic Data
                    </button>
                    <button id="resetBtn" class="btn btn-secondary">
                        🔄 Generate Another Dataset
                    </button>
                </div>
            </section>

            <!-- Synthetic Data Viewer -->
            <section class="synthetic-viewer-section" id="syntheticViewerSection" style="display: none;">
                <h2>🎯 Generated Synthetic Data</h2>
                <div class="table-container">
                    <table id="syntheticTable" class="data-table">
                        <thead id="syntheticHead"></thead>
                        <tbody id="syntheticBody"></tbody>
                    </table>
                </div>
                <div class="button-group">
                    <button id="downloadSyntheticBtn" class="btn btn-primary">
                        ⬇️ Download This Data
                    </button>
                    <button id="regenerateBtn" class="btn btn-secondary">
                        🔄 Regenerate
                    </button>
                </div>
            </section>

            <!-- Metadata Display -->
            <section class="metadata-section" id="metadataSection" style="display: none;">
                <h2>Extracted Metadata</h2>
                <div id="metadataContent"></div>
            </section>


            <!-- Experimental Features - Collapsible (Hidden until data loaded) -->
            <details class="experimental-section" id="experimentalSection" style="display: none;">
                <summary>🧪 Experimental Features</summary>
                <div class="experiment-buttons">
                    <button id="corruptDataBtn" class="experiment-btn">💥 Corrupt</button>
                    <button id="duplicateRowsBtn" class="experiment-btn">📋 Duplicate</button>
                    <button id="addNullsBtn" class="experiment-btn">❓ Add Nulls</button>
                    <button id="scrambleColBtn" class="experiment-btn">🔀 Scramble</button>
                    <button id="generateOutliersBtn" class="experiment-btn">📈 Outliers</button>
                </div>
            </details>
        </main>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
            <div class="spinner"></div>
            <p id="loadingMessage">Processing...</p>
        </div>

        <!-- Error Modal -->
        <div id="errorModal" class="modal" style="display: none;">
            <div class="modal-content">
                <h3>Error</h3>
                <p id="errorMessage"></p>
                <button onclick="closeError()" class="btn btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
    <script src="/static/js/data-editor.js"></script>
</body>
</html>